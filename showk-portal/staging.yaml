resources:
- name: app-staging
  type: git
  source:
    uri: "https://github.com/containerdaysjp/showk-portal"
    branch: staging

- name: showk-portal-image
  type: docker-image
  source:
    repository: containerdaysjp/showk-portal
    username: ((registry_user))
    password: ((registry_password))

jobs:
- name: staging
  plan:
  - get: app-staging
    trigger: true

  - put: showk-portal-image
    params:
      build: app-staging/
      tag_file: app-staging/.git/refs/heads/staging
      tag_prefix: stg-
